<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="baidu-site-verification" content="4VgVZ78vNs"><meta name="google-site-verification" content="fFPOHpbXBh9IoQIShIVnGpxUmWIa55Aa1187v0em7Lo"><meta name="description"><title>Redmine安装 | Victor</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redmine安装</h1><a id="logo" href="/.">Victor</a><p class="description">问渠哪得清如许，为有源头活水来</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redmine安装</h1><div class="post-meta">Aug 4, 2017<span> | </span><span class="category"><a href="/categories/项目管理/">项目管理</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/08/04/Redmine安装/" href="/2017/08/04/Redmine安装/#comments" class="ds-thread-count"></a><div class="post-content"><p><a href="http://www.redmine.org" target="_blank" rel="noopener">Redmine</a>是一个开源的、基于Web的项目管理和缺陷跟踪工具。它用日历和甘特图辅助项目及进度可视化显示。同时它又支持多项目管理。Redmine是一个自由开放 源码软件解决方案，它提供集成的项目管理功能，问题跟踪，并为多个版本控制选项的支持。虽说像IBM Rational Team Concert的商业项目调查工具已经很强大了，但想坚持一个自由和开放源码的解决方案，可能会发现Redmine是一个有用的Scrum和敏捷的选择。 由于Redmine的设计受到Rrac的较大影响，所以它们的软件包有很多相似的特征。Redmine建立在Ruby on Rails的框架之上，他可以夸平台和数据库。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>推荐使用rvm安装ruby，具体安装教程，参见<a href="http://blog.csdn.net/yangcs2009/article/details/50634424" target="_blank" rel="noopener">centos下rvm安装</a></p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> redmine <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'redmine'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'my_password'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> redmine.* <span class="keyword">TO</span> <span class="string">'redmine'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>访问<a href="http://www.redmine.org/projects/redmine/wiki/Download" target="_blank" rel="noopener">Redmine官网</a>下载。</p>
<p>这里我以下载 <a href="http://www.redmine.org/releases/redmine-3.4.2.zip" target="_blank" rel="noopener">redmine-3.4.2.zip</a>为例子。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /home/redmine</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://www.redmine.org/releases/redmine-3.4.2.zip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> unzip redmine-3.4.2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> redmine-3.4.2</span></span><br></pre></td></tr></table></figure>
<h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>为了下载依赖包速度快，可以使用<a href="https://ruby.taobao.org/" target="_blank" rel="noopener">淘宝的gems源</a>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gem install bundler</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> bundle install --without development <span class="built_in">test</span> //这里注意在redmine根目录下执行(本例是/home/redmine/redmine-3.4.2)</span></span><br></pre></td></tr></table></figure>
<h3 id="可能遇到的两个坑"><a href="#可能遇到的两个坑" class="headerlink" title="可能遇到的两个坑"></a>可能遇到的两个坑</h3><ol>
<li>rmagick 安装失败</li>
</ol>
<p>需要安装rmagick所依赖的开发库，然后再继续执行bundle install</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libmagickwand-dev imagemagick //Ubuntu</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install ImageMagick-devel ImageMagick //Centos</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>mysql2 安装失败</li>
</ol>
<p>需要安装mysql2所依赖的开发库，然后再继续执行bundle install</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">sudo apt-get install libmysqld-dev //Ubuntu</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">sudo yum install mysql-devel //Centos</span></span><br></pre></td></tr></table></figure>
<h2 id="秘钥生成"><a href="#秘钥生成" class="headerlink" title="秘钥生成"></a>秘钥生成</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bundle <span class="built_in">exec</span> rake generate_secret_token</span></span><br></pre></td></tr></table></figure>
<h2 id="数据库迁移，生成redmine需要的表数据"><a href="#数据库迁移，生成redmine需要的表数据" class="headerlink" title="数据库迁移，生成redmine需要的表数据"></a>数据库迁移，生成redmine需要的表数据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp config/database.yml.example config/database.yml</span></span><br></pre></td></tr></table></figure>
<p>编辑 config/databaase.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">production:</span></span><br><span class="line">  <span class="attr">adapter:</span> <span class="string">mysql2</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">redmine</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">redmine</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">my_password</span></span><br></pre></td></tr></table></figure>
<p>执行迁移</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> RAILS_ENV=production bundle <span class="built_in">exec</span> rake db:migrate</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> RAILS_ENV=production bundle <span class="built_in">exec</span> rake redmine:load_default_data //可选操作，导入默认数据。这里不操作，首次访问admin界面时，web页面也有同样的操作按钮</span></span><br></pre></td></tr></table></figure>
<h2 id="启动Redmine"><a href="#启动Redmine" class="headerlink" title="启动Redmine"></a>启动Redmine</h2><p>检测测试一下，可以使用Redmine自带的Webrick服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bundle <span class="built_in">exec</span> rails server webrick -e production</span></span><br></pre></td></tr></table></figure>
<p>生产使用的话，这里演示unicorn</p>
<h3 id="1-编辑Gemfile，增加unicorn配置，将下面代码插入文件中。"><a href="#1-编辑Gemfile，增加unicorn配置，将下面代码插入文件中。" class="headerlink" title="1. 编辑Gemfile，增加unicorn配置，将下面代码插入文件中。"></a>1. 编辑Gemfile，增加unicorn配置，将下面代码插入文件中。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Application server add by armink</span></span><br><span class="line"><span class="string">group</span> <span class="string">:unicorn</span> <span class="string">do</span></span><br><span class="line">  <span class="string">gem</span> <span class="string">"unicorn"</span><span class="string">,</span> <span class="string">'~&gt; 4.6.3'</span></span><br><span class="line">  <span class="string">gem</span> <span class="string">'unicorn-worker-killer'</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-通过bundle更新Gem依赖，此时会看到unicorn被安装"><a href="#2-通过bundle更新Gem依赖，此时会看到unicorn被安装" class="headerlink" title="2. 通过bundle更新Gem依赖，此时会看到unicorn被安装"></a>2. 通过bundle更新Gem依赖，此时会看到unicorn被安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bundle install --without development test</span><br></pre></td></tr></table></figure>
<h3 id="3-增加unicorn配置文件config-unicorn-rb"><a href="#3-增加unicorn配置文件config-unicorn-rb" class="headerlink" title="3. 增加unicorn配置文件config/unicorn.rb"></a>3. 增加unicorn配置文件config/unicorn.rb</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sample verbose configuration file for Unicorn (not Rack)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This configuration file documents many features of Unicorn</span></span><br><span class="line"><span class="comment"># that may not be needed for some applications. See</span></span><br><span class="line"><span class="comment"># http://unicorn.bogomips.org/examples/unicorn.conf.minimal.rb</span></span><br><span class="line"><span class="comment"># for a much simpler configuration file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See http://unicorn.bogomips.org/Unicorn/Configurator.html for complete</span></span><br><span class="line"><span class="comment"># documentation.</span></span><br><span class="line"><span class="comment"># Use at least one worker per core if you're on a dedicated server,</span></span><br><span class="line"><span class="comment"># more will usually help for _short_ waits on databases/caches.</span></span><br><span class="line">worker_processes <span class="number">2</span></span><br><span class="line"><span class="comment"># Since Unicorn is never exposed to outside clients, it does not need to</span></span><br><span class="line"><span class="comment"># run on the standard HTTP port (80), there is no reason to start Unicorn</span></span><br><span class="line"><span class="comment"># as root unless it's from system init scripts.</span></span><br><span class="line"><span class="comment"># If running the master process as root and the workers as an unprivileged</span></span><br><span class="line"><span class="comment"># user, do this to switch euid/egid in the workers (also chowns logs):</span></span><br><span class="line"><span class="comment"># user "unprivileged_user", "unprivileged_group"</span></span><br><span class="line"><span class="comment"># Help ensure your application will always spawn in the symlinked</span></span><br><span class="line"><span class="comment"># "current" directory that Capistrano sets up.</span></span><br><span class="line">working_directory <span class="string">"/home/redmine/redmine"</span> <span class="comment"># available in 0.94.0+</span></span><br><span class="line"><span class="comment"># listen on both a Unix domain socket and a TCP port,</span></span><br><span class="line"><span class="comment"># we use a shorter backlog for quicker failover when busy</span></span><br><span class="line">listen <span class="string">"/home/redmine/redmine/tmp/sockets/redmine.socket"</span>, <span class="symbol">:backlog</span> =&gt; <span class="number">64</span></span><br><span class="line">listen <span class="number">3000</span>, <span class="symbol">:tcp_nopush</span> =&gt; <span class="literal">true</span></span><br><span class="line"><span class="comment"># nuke workers after 30 seconds instead of 60 seconds (the default)</span></span><br><span class="line">timeout <span class="number">30</span></span><br><span class="line"><span class="comment"># feel free to point this anywhere accessible on the filesystem</span></span><br><span class="line">pid <span class="string">"/home/redmine/redmine/tmp/pids/unicorn.pid"</span></span><br><span class="line"><span class="comment"># By default, the Unicorn logger will write to stderr.</span></span><br><span class="line"><span class="comment"># Additionally, some applications/frameworks log to stderr or stdout,</span></span><br><span class="line"><span class="comment"># so prevent them from going to /dev/null when daemonized here:</span></span><br><span class="line">stderr_path <span class="string">"/home/redmine/redmine/log/unicorn.stderr.log"</span></span><br><span class="line">stdout_path <span class="string">"/home/redmine/redmine/log/unicorn.stdout.log"</span></span><br><span class="line"><span class="comment"># combine Ruby 2.0.0dev or REE with "preload_app true" for memory savings</span></span><br><span class="line"><span class="comment"># http://rubyenterpriseedition.com/faq.html#adapt_apps_for_cow</span></span><br><span class="line">preload_app <span class="literal">true</span></span><br><span class="line">GC.respond_to?(<span class="symbol">:copy_on_write_friendly=</span>) <span class="keyword">and</span></span><br><span class="line">  GC.copy_on_write_friendly = <span class="literal">true</span></span><br><span class="line"><span class="comment"># Enable this flag to have unicorn test client connections by writing the</span></span><br><span class="line"><span class="comment"># beginning of the HTTP headers before calling the application.  This</span></span><br><span class="line"><span class="comment"># prevents calling the application for connections that have disconnected</span></span><br><span class="line"><span class="comment"># while queued.  This is only guaranteed to detect clients on the same</span></span><br><span class="line"><span class="comment"># host unicorn runs on, and unlikely to detect disconnects even on a</span></span><br><span class="line"><span class="comment"># fast LAN.</span></span><br><span class="line">check_client_connection <span class="literal">false</span></span><br><span class="line">before_fork <span class="keyword">do</span> <span class="params">|server, worker|</span></span><br><span class="line">  <span class="comment"># the following is highly recomended for Rails + "preload_app true"</span></span><br><span class="line">  <span class="comment"># as there's no need for the master process to hold a connection</span></span><br><span class="line">  <span class="keyword">defined</span>?(ActiveRecord::Base) <span class="keyword">and</span></span><br><span class="line">    ActiveRecord::Base.connection.disconnect!</span><br><span class="line">  <span class="comment"># The following is only recommended for memory/DB-constrained</span></span><br><span class="line">  <span class="comment"># installations.  It is not needed if your system can house</span></span><br><span class="line">  <span class="comment"># twice as many worker_processes as you have configured.</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># This allows a new master process to incrementally</span></span><br><span class="line">  <span class="comment"># phase out the old master process with SIGTTOU to avoid a</span></span><br><span class="line">  <span class="comment"># thundering herd (especially in the "preload_app false" case)</span></span><br><span class="line">  <span class="comment"># when doing a transparent upgrade.  The last worker spawned</span></span><br><span class="line">  <span class="comment"># will then kill off the old master process with a SIGQUIT.</span></span><br><span class="line">  old_pid = <span class="string">"<span class="subst">#&#123;server.config[<span class="symbol">:pid</span>]&#125;</span>.oldbin"</span></span><br><span class="line">  <span class="keyword">if</span> old_pid != server.pid</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      sig = (worker.nr + <span class="number">1</span>) &gt;= server.worker_processes ? <span class="symbol">:QUIT</span> : <span class="symbol">:TTOU</span></span><br><span class="line">      Process.kill(sig, File.read(old_pid).to_i)</span><br><span class="line">    <span class="keyword">rescue</span> Errno::ENOENT, Errno::ESRCH</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># Throttle the master from forking too quickly by sleeping.  Due</span></span><br><span class="line">  <span class="comment"># to the implementation of standard Unix signal handlers, this</span></span><br><span class="line">  <span class="comment"># helps (but does not completely) prevent identical, repeated signals</span></span><br><span class="line">  <span class="comment"># from being lost when the receiving process is busy.</span></span><br><span class="line">  <span class="comment"># sleep 1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">after_fork <span class="keyword">do</span> <span class="params">|server, worker|</span></span><br><span class="line">  <span class="comment"># per-process listener ports for debugging/admin/migrations</span></span><br><span class="line">  <span class="comment"># addr = "127.0.0.1:#&#123;9293 + worker.nr&#125;"</span></span><br><span class="line">  <span class="comment"># server.listen(addr, :tries =&gt; -1, :delay =&gt; 5, :tcp_nopush =&gt; true)</span></span><br><span class="line">  <span class="comment"># the following is *required* for Rails + "preload_app true",</span></span><br><span class="line">  <span class="keyword">defined</span>?(ActiveRecord::Base) <span class="keyword">and</span></span><br><span class="line">    ActiveRecord::Base.establish_connection</span><br><span class="line">  <span class="comment"># if preload_app is true, then you may also want to check and</span></span><br><span class="line">  <span class="comment"># restart any other shared sockets/descriptors such as Memcached,</span></span><br><span class="line">  <span class="comment"># and Redis.  TokyoCabinet file handles are safe to reuse</span></span><br><span class="line">  <span class="comment"># between any number of forked children (assuming your kernel</span></span><br><span class="line">  <span class="comment"># correctly implements pread()/pwrite() system calls)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-添加启动脚本script-web，包含对unicorn的启动、停止等命令控制"><a href="#4-添加启动脚本script-web，包含对unicorn的启动、停止等命令控制" class="headerlink" title="4. 添加启动脚本script/web，包含对unicorn的启动、停止等命令控制"></a>4. 添加启动脚本script/web，包含对unicorn的启动、停止等命令控制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">cd $(dirname $0)/..</span><br><span class="line">app_root=$(pwd)</span><br><span class="line">unicorn_pidfile="$app_root/tmp/pids/unicorn.pid"</span><br><span class="line">unicorn_config="$app_root/config/unicorn.rb"</span><br><span class="line">function get_unicorn_pid</span><br><span class="line">&#123;</span><br><span class="line">  local pid=$(cat $unicorn_pidfile)</span><br><span class="line">  if [ -z $pid ] ; then</span><br><span class="line">    echo "Could not find a PID in $unicorn_pidfile"</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">  unicorn_pid=$pid</span><br><span class="line">&#125;</span><br><span class="line">function start</span><br><span class="line">&#123;</span><br><span class="line">  bundle exec unicorn_rails -D -c $unicorn_config -E $RAILS_ENV</span><br><span class="line">&#125;</span><br><span class="line">function stop</span><br><span class="line">&#123;</span><br><span class="line">  get_unicorn_pid</span><br><span class="line">  kill -QUIT $unicorn_pid</span><br><span class="line">&#125;</span><br><span class="line">function reload</span><br><span class="line">&#123;</span><br><span class="line">  get_unicorn_pid</span><br><span class="line">  kill -USR2 $unicorn_pid</span><br><span class="line">&#125;</span><br><span class="line">case "$1" in</span><br><span class="line">  start)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  stop)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  reload)</span><br><span class="line">    reload</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    echo "Usage: RAILS_ENV=your_env $0 &#123;start|stop|reload&#125;"</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<h3 id="5-添加开机启动脚本-etc-init-d-redmine"><a href="#5-添加开机启动脚本-etc-init-d-redmine" class="headerlink" title="5. 添加开机启动脚本/etc/init.d/redmine"></a>5. 添加开机启动脚本/etc/init.d/redmine</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">! /bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> REDMINE</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maintainer: @armink</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Authors: armink.ztl@gmail.com, @armink</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:          redmine</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:    <span class="variable">$local_fs</span> <span class="variable">$remote_fs</span> <span class="variable">$network</span> <span class="variable">$syslog</span> redis-server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:     <span class="variable">$local_fs</span> <span class="variable">$remote_fs</span> <span class="variable">$network</span> <span class="variable">$syslog</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:      0 1 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DO NOT EDIT THIS FILE!</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This file will be overwritten on update.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Instead add/change your variables <span class="keyword">in</span> /etc/default/redmine</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An example defaults file can be found <span class="keyword">in</span> lib/support/init.d/redmine.default.example</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Environment variables</span></span></span><br><span class="line">RAILS_ENV="production"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Script variable names should be lower-case not to conflict with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> internal /bin/sh variables such as PATH, EDITOR or SHELL.</span></span><br><span class="line">app_user="redmine"</span><br><span class="line">app_root="/home/$app_user/redmine-3.4.2"</span><br><span class="line">pid_path="$app_root/tmp/pids"</span><br><span class="line">socket_path="$app_root/tmp/sockets"</span><br><span class="line">web_server_pid_path="$pid_path/unicorn.pid"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Read configuration variable file <span class="keyword">if</span> it is present</span></span><br><span class="line">test -f /etc/default/redmine &amp;&amp; . /etc/default/redmine</span><br><span class="line"><span class="meta">#</span><span class="bash"> Switch to the app_user <span class="keyword">if</span> it is not he/she who is running the script.</span></span><br><span class="line">if [ "$USER" != "$app_user" ]; then</span><br><span class="line">  sudo -u "$app_user" -H -i $0 "$@"; exit;</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"> Switch to the redmine path, <span class="built_in">exit</span> on failure.</span></span><br><span class="line">if ! cd "$app_root" ; then</span><br><span class="line"> echo "Failed to cd into $app_root, exiting!";  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Init Script functions</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Gets the pids from the files</span></span></span><br><span class="line">check_pids()&#123;</span><br><span class="line">  if ! mkdir -p "$pid_path"; then</span><br><span class="line">    echo "Could not create the path $pid_path needed to store the pids."</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If there exists a file <span class="built_in">which</span> should hold the value of the Unicorn pid: <span class="built_in">read</span> it.</span></span><br><span class="line">  if [ -f "$web_server_pid_path" ]; then</span><br><span class="line">    wpid=$(cat "$web_server_pid_path")</span><br><span class="line">  else</span><br><span class="line">    wpid=0</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Called when we have started the two processes and are waiting for their pid files.</span></span></span><br><span class="line">wait_for_pids()&#123;</span><br><span class="line">  i=0;</span><br><span class="line">  while [ ! -f $web_server_pid_path ]; do</span><br><span class="line">    sleep 0.1;</span><br><span class="line">    i=$((i+1))</span><br><span class="line">    if [ $((i%10)) = 0 ]; then</span><br><span class="line">      echo -n "."</span><br><span class="line">    elif [ $((i)) = 301 ]; then</span><br><span class="line">      echo "Waited 30s for the processes to write their pids, something probably went wrong."</span><br><span class="line">      exit 1;</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">  echo</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> We use the pids <span class="keyword">in</span> so many parts of the script it makes sense to always check them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only after start() is run should the pids change.</span></span><br><span class="line">check_pids</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Checks whether the different parts of the service are already running or not.</span></span></span><br><span class="line">check_status()&#123;</span><br><span class="line">  check_pids</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If the web server is running <span class="built_in">kill</span> -0 <span class="variable">$wpid</span> returns <span class="literal">true</span>, or rather 0.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Checks of *_status should only check <span class="keyword">for</span> == 0 or != 0, never anything <span class="keyword">else</span>.</span></span><br><span class="line">  if [ $wpid -ne 0 ]; then</span><br><span class="line">    kill -0 "$wpid" 2&gt;/dev/null</span><br><span class="line">    web_status="$?"</span><br><span class="line">  else</span><br><span class="line">    web_status="-1"</span><br><span class="line">  fi</span><br><span class="line">  if [ $web_status = 0 ]; then</span><br><span class="line">    redmine_status=0</span><br><span class="line">  else</span><br><span class="line">    # http://refspecs.linuxbase.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html</span><br><span class="line">    # code 3 means 'program is not running'</span><br><span class="line">    redmine_status=3</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Check for stale pids and remove them if necessary.</span></span></span><br><span class="line">check_stale_pids()&#123;</span><br><span class="line">  check_status</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If there is a pid it is something <span class="keyword">else</span> than 0, the service is running <span class="keyword">if</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> *_status is == 0.</span></span><br><span class="line">  if [ "$wpid" != "0" -a "$web_status" != "0" ]; then</span><br><span class="line">    echo "Removing stale Unicorn web server pid. This is most likely caused by the web server crashing the last time it ran."</span><br><span class="line">    if ! rm "$web_server_pid_path"; then</span><br><span class="line">      echo "Unable to remove stale pid, exiting."</span><br><span class="line">      exit 1</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># If no parts of the service is running, bail out.</span></span></span><br><span class="line">exit_if_not_running()&#123;</span><br><span class="line">  check_stale_pids</span><br><span class="line">  if [ "$web_status" != "0" ]; then</span><br><span class="line">    echo "Redmine is not running."</span><br><span class="line">    exit</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Starts Unicorn if it's not running.</span></span></span><br><span class="line">start() &#123;</span><br><span class="line">  check_stale_pids</span><br><span class="line">  if [ "$web_status" != "0" ]; then</span><br><span class="line">    echo -n "Starting the Redmine Unicorn."</span><br><span class="line">  fi</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Then check <span class="keyword">if</span> the service is running. If it is: don<span class="string">'t start again.</span></span></span><br><span class="line">  if [ "$web_status" = "0" ]; then</span><br><span class="line">    echo "The Unicorn web server already running with pid $wpid, not restarting."</span><br><span class="line">  else</span><br><span class="line">    # Remove old socket if it exists</span><br><span class="line">    rm -f "$socket_path"/redmine.socket 2&gt;/dev/null</span><br><span class="line">    # Start the web server</span><br><span class="line">    RAILS_ENV=$RAILS_ENV script/web start &amp;</span><br><span class="line">  fi</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Wait <span class="keyword">for</span> the pids to be planted</span></span><br><span class="line">  wait_for_pids</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Finally check the status to tell wether or not Redmine is running</span></span><br><span class="line">  print_status</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Asks the Unicorn if it would be so kind as to stop, if not kills it.</span></span></span><br><span class="line">stop() &#123;</span><br><span class="line">  exit_if_not_running</span><br><span class="line">  if [ "$web_status" = "0" ]; then</span><br><span class="line">    echo -n "Shutting down the Redmine Unicorn"</span><br><span class="line">  fi</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If the Unicorn web server is running, tell it to stop;</span></span><br><span class="line">  if [ "$web_status" = "0" ]; then</span><br><span class="line">     RAILS_ENV=$RAILS_ENV script/web stop</span><br><span class="line">  fi</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If something needs to be stopped, lets <span class="built_in">wait</span> <span class="keyword">for</span> it to stop. Never use SIGKILL <span class="keyword">in</span> a script.</span></span><br><span class="line">  while [ "$web_status" = "0" ]; do</span><br><span class="line">    sleep 1</span><br><span class="line">    check_status</span><br><span class="line">    printf "."</span><br><span class="line">    if [ "$web_status" != "0" ]; then</span><br><span class="line">      printf "\n"</span><br><span class="line">      break</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">  sleep 1</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Cleaning up unused pids</span></span><br><span class="line">  rm "$web_server_pid_path" 2&gt;/dev/null</span><br><span class="line">  print_status</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Prints the status of Redmine and it's components.</span></span></span><br><span class="line">print_status() &#123;</span><br><span class="line">  check_status</span><br><span class="line">  if [ "$web_status" = "0" ]; then</span><br><span class="line">      echo "The Redmine is \033[32mrunning\033[0m.\nThe Redmine Unicorn web server pid is $wpid."</span><br><span class="line">  else</span><br><span class="line">      printf "The Redmine is \033[31mnot running\033[0m.\n"</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Tells unicorn to reload it's config </span></span></span><br><span class="line">reload()&#123;</span><br><span class="line">  exit_if_not_running</span><br><span class="line">  if [ "$wpid" = "0" ];then</span><br><span class="line">    echo "The Redmine Unicorn Web server is not running thus its configuration can't be reloaded."</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">  printf "Reloading Redmine Unicorn configuration... "</span><br><span class="line">  RAILS_ENV=$RAILS_ENV script/web reload</span><br><span class="line">  echo "Done."</span><br><span class="line">  wait_for_pids</span><br><span class="line">  print_status</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Restarts Unicorn.</span></span></span><br><span class="line">restart()&#123;</span><br><span class="line">  check_status</span><br><span class="line">  if [ "$web_status" = "0" ]; then</span><br><span class="line">    stop</span><br><span class="line">  fi</span><br><span class="line">  start</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Finally the input handling.</span></span></span><br><span class="line">case "$1" in</span><br><span class="line">  start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">  stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">  restart)</span><br><span class="line">        restart</span><br><span class="line">        ;;</span><br><span class="line">  reload|force-reload)</span><br><span class="line">    reload</span><br><span class="line">        ;;</span><br><span class="line">  status)</span><br><span class="line">        print_status</span><br><span class="line">        exit $redmine_status</span><br><span class="line">        ;;</span><br><span class="line">  *)</span><br><span class="line">        echo "Usage: service redmine &#123;start|stop|restart|reload|status&#125;"</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<p>设置该脚本文件属性为可执行文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod a+x /etc/init.d/redmine</span></span><br></pre></td></tr></table></figure>
<h3 id="6-加入开机启动序列-以centos-7-x为例"><a href="#6-加入开机启动序列-以centos-7-x为例" class="headerlink" title="6. 加入开机启动序列(以centos 7.x为例)"></a>6. 加入开机启动序列(以centos 7.x为例)</h3><p>由于centos7默认降低了/etc/rc.d/rc.local的权限，所以需要手动添加可执行权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod a+x /etc/rc.d/rc.local</span></span><br></pre></td></tr></table></figure>
<p>编辑/etc/rc.d/rc.local，将开机时需要执行的指令追加进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">/etc/init.d/redmine start</span><br></pre></td></tr></table></figure>
<p>现在可以reboot试下是否能直接访问 <a href="http://127.0.0.1:3000。" target="_blank" rel="noopener">http://127.0.0.1:3000。</a></p>
<p>这里也有可能遇到防火墙的坑，以<a href="https://xiaoguo.net/wiki/centos-7-firewalld.html" target="_blank" rel="noopener">centos7.x</a>为例，可以这么执行;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> firewall-cmd --permanent --add-port=3000/tcp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl restart firewalld</span></span><br></pre></td></tr></table></figure>
<h2 id="邮件配置"><a href="#邮件配置" class="headerlink" title="邮件配置"></a>邮件配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp config/configuration.yml.example config/configuration.yml</span></span><br></pre></td></tr></table></figure>
<p>编辑config/configuration.yml, 以腾讯企业邮箱为例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">email_delivery:</span></span><br><span class="line">    <span class="attr">delivery_method:</span> <span class="string">:async_smtp</span></span><br><span class="line">    <span class="attr">smtp_settings:</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">465</span></span><br><span class="line">      <span class="attr">ssl:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">domain:</span> <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">      <span class="attr">authentication:</span> <span class="string">:login</span></span><br><span class="line">      <span class="attr">user_name:</span> <span class="string">"foo@bar.com"</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">"your_pwd"</span></span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://victor87.coding.me/2017/08/04/Redmine安装/" data-id="ck4ccwn39003a19vp30439vpm" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Redmine/">Redmine</a><a href="/tags/Rails/">Rails</a><a href="/tags/Shell/">Shell</a></div><div class="post-nav"><a href="/2017/08/11/SELinux/" class="pre">SELinux</a><a href="/2017/07/21/阿里云数据盘初始化/" class="next">阿里云数据盘初始化</a></div><div data-thread-key="2017/08/04/Redmine安装/" data-title="Redmine安装" data-url="http://victor87.coding.me/2017/08/04/Redmine安装/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/08/04/Redmine安装/" data-title="Redmine安装" data-url="http://victor87.coding.me/2017/08/04/Redmine安装/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://victor87.coding.me"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IoT/">IoT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-Mac/">iOS & Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据-AI/">大数据 & AI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络安全/">网络安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目管理/">项目管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/消息队列/" style="font-size: 15px;">消息队列</a> <a href="/tags/EasyDL/" style="font-size: 15px;">EasyDL</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Android-Things/" style="font-size: 15px;">Android Things</a> <a href="/tags/物联网/" style="font-size: 15px;">物联网</a> <a href="/tags/NXP-i-MX7D/" style="font-size: 15px;">NXP i.MX7D</a> <a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/持续集成/" style="font-size: 15px;">持续集成</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Coding/" style="font-size: 15px;">Coding</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Firebase/" style="font-size: 15px;">Firebase</a> <a href="/tags/GitLab/" style="font-size: 15px;">GitLab</a> <a href="/tags/travis/" style="font-size: 15px;">travis</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Annotation/" style="font-size: 15px;">Annotation</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/动态代理/" style="font-size: 15px;">动态代理</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/守护进程/" style="font-size: 15px;">守护进程</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/备份/" style="font-size: 15px;">备份</a> <a href="/tags/还原/" style="font-size: 15px;">还原</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Homebrew/" style="font-size: 15px;">Homebrew</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/NoSQL/" style="font-size: 15px;">NoSQL</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/Mosquitto/" style="font-size: 15px;">Mosquitto</a> <a href="/tags/深度学习/" style="font-size: 15px;">深度学习</a> <a href="/tags/权限认证/" style="font-size: 15px;">权限认证</a> <a href="/tags/QQ授权/" style="font-size: 15px;">QQ授权</a> <a href="/tags/Redmine/" style="font-size: 15px;">Redmine</a> <a href="/tags/Rails/" style="font-size: 15px;">Rails</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/R/" style="font-size: 15px;">R</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/科学计算/" style="font-size: 15px;">科学计算</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Spring-Boot/" style="font-size: 15px;">Spring Boot</a> <a href="/tags/Systemd/" style="font-size: 15px;">Systemd</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Yii2/" style="font-size: 15px;">Yii2</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/图片浏览器/" style="font-size: 15px;">图片浏览器</a> <a href="/tags/宏定义/" style="font-size: 15px;">宏定义</a> <a href="/tags/软键盘/" style="font-size: 15px;">软键盘</a> <a href="/tags/图片截取/" style="font-size: 15px;">图片截取</a> <a href="/tags/Memcached/" style="font-size: 15px;">Memcached</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Gitlab/" style="font-size: 15px;">Gitlab</a> <a href="/tags/Swoole/" style="font-size: 15px;">Swoole</a> <a href="/tags/产品/" style="font-size: 15px;">产品</a> <a href="/tags/需求分析/" style="font-size: 15px;">需求分析</a> <a href="/tags/Range/" style="font-size: 15px;">Range</a> <a href="/tags/重叠/" style="font-size: 15px;">重叠</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/移动支付/" style="font-size: 15px;">移动支付</a> <a href="/tags/985/" style="font-size: 15px;">985</a> <a href="/tags/211/" style="font-size: 15px;">211</a> <a href="/tags/大学分布/" style="font-size: 15px;">大学分布</a> <a href="/tags/Fresco/" style="font-size: 15px;">Fresco</a> <a href="/tags/ARC/" style="font-size: 15px;">ARC</a> <a href="/tags/端口映射/" style="font-size: 15px;">端口映射</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/启动原理/" style="font-size: 15px;">启动原理</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/19/如何将内网Web服务暴露给外网访问/">如何将内网Web服务暴露给外网访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/18/5分钟教你实现头像识别/">5分钟教你实现头像识别</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/20/Mac双系统安装/">Mac双系统安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/22/Centos7-php升级/">Centos7 php升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/21/PHP数据类型声明那些事/">PHP数据类型声明那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/GitLab持续集成CI/">GitLab持续集成CI</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/20/GitLab重置管理员密码/">GitLab重置管理员密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/Git冲突解决方案/">Git冲突解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/22/Spring-Boot入门/">Spring Boot入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/区间Range重叠算法/">区间Range重叠算法</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://jikedaohang.com/" title="极客导航" target="_blank">极客导航</a><ul></ul><a href="http://www.rowkey.me/" title="后端技术杂谈" target="_blank">后端技术杂谈</a><ul></ul><a href="http://www.fancyecommerce.com/" title="YII2 教程" target="_blank">YII2 教程</a><ul></ul><a href="http://objccn.io/" title="objc中国" target="_blank">objc中国</a><ul></ul><a href="http://www.ruanyifeng.com/" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Victor.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'wangsheng87'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>