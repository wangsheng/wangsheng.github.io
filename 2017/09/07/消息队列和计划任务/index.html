<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="baidu-site-verification" content="4VgVZ78vNs"><meta name="google-site-verification" content="fFPOHpbXBh9IoQIShIVnGpxUmWIa55Aa1187v0em7Lo"><meta name="description"><title>消息队列和计划任务 | Victor</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">消息队列和计划任务</h1><a id="logo" href="/.">Victor</a><p class="description">问渠哪得清如许，为有源头活水来</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">消息队列和计划任务</h1><div class="post-meta">Sep 7, 2017<span> | </span><span class="category"><a href="/categories/PHP/">PHP</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/09/07/消息队列和计划任务/" href="/2017/09/07/消息队列和计划任务/#comments" class="ds-thread-count"></a><div class="post-content"><p>软件系统开发中，经常会遇到需要异步执行任务的场景，比如某些事件会触发异步发送邮件，再比如订单30分钟未支付自动取消等等。</p>
<p>那么这种场景，如何处理呢？对于Java等自带多线程的语言，开发者可能第一时间想到的方案就是开启一个新的线程来处理这样的异步任务。但是，线程开启多了，业务复杂了，就出现严重的失控局面。那么有没有更好的处理方案呢？深入一想，这不就是典型的<code>生产和消费</code>模式么，所以可以采用消息队列来完美解决此种场景。比较常见的消息队列系统有<a href="http://memcachedb.org/memcacheq/" target="_blank" rel="noopener">Memcacheq</a>、<a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">Rabbitmq</a>。</p>
<p>消息队列系统其实就是一个最简单的先进先出队列，队列的一个成员就是一个字符串(多数是用json格式)，用来标识要处理的具体任务。但细细一想，消息队列系统也存在蛮多疑问的：</p>
<ol>
<li>消息队列只能存储字符串类型的数据，那么如何将一个发送邮件的<code>任务</code>，转换为消息队列中的一个<code>消息</code>呢？</li>
<li>消息队列只负责消息的存入与取出，本身不能执行任何程序，那么我们要如何从消息队列中一个一个取出，再将这些消息转化回任务并执行呢？</li>
<li>我们无法预知消息队列何时会有消息进入，所以我们的任务执行程序还需要具备监控消息队列的能力，也就是一个常驻后台的守护进程。</li>
<li>PHP的Web程序都以CGI的方式运行，无法常驻内存。但是PHP还有CLI模式，那么守护进程是否能以PHP-CLI来实现呢？</li>
<li>守护进程的状态监控如何实现呢？</li>
</ol>
<p>对于以上问题，我们能否找到已有的轮子呢？熟悉Ruby的程序员可能比较熟悉<a href="https://github.com/resque/resque" target="_blank" rel="noopener">Resque</a>。它是一个以Redis作为后台消息队列，可以处理多队列的<code>生产和消费</code>模型实现。也正是因为简单出色的实现思路，市场上出现了其他语言的clone版本，比如 <a href="https://github.com/chrisboulton/php-resque" target="_blank" rel="noopener">php-resque</a>、<a href="https://github.com/binarydud/pyres" target="_blank" rel="noopener">pyres</a>、<a href="https://github.com/taskrabbit/node-resque" target="_blank" rel="noopener">node-resque</a>。Reque的具体工作流程，见下图:</p>
<p><img src="http://img.iaquam.com/image/Resque-workflow.png" alt="Resque 流程图"></p>
<p>介于目前我手头的项目用的PHP的Yii2框架，所以本篇以<code>php-resque</code>为例，介绍使用方法</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>需要安装和配置Redis，具体可参见 <a href="http://victor87.coding.me/2017/08/31/redis/">Redis-Yii2</a></p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>composer.json文件里添加php-resque(处理即时任务)和php-resque-scheduler(处理计划任务)依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;chrisboulton/php-resque&quot;: &quot;dev-master&quot;,</span><br><span class="line">&quot;chrisboulton/php-resque-scheduler&quot;: &quot;dev-master&quot;</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>通过上面的流程图，可以看出，这里最主要的是消费者Worker守护进程的启动，由Worker来具体消费队列里的消息，转换为任务Job，进而异步处理。</p>
<h3 id="Worker进程的配置"><a href="#Worker进程的配置" class="headerlink" title="Worker进程的配置"></a>Worker进程的配置</h3><p>为了<code>Worker</code>启动方便，我这里将启动脚本写成Yii2的console脚本，如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">console</span>\<span class="title">controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">common</span>\<span class="title">components</span>\<span class="title">Yii2Resque</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Log</span>\<span class="title">LogLevel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque_Log</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque_Redis</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque_Worker</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">ResqueScheduler_Worker</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Yii</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">console</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Resque控制器，主要用来启动Resque</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Class ResqueController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> console\controllers</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResqueController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动消费 QUEUE_ORDERS 队列的 Worker</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ./yii resque/orders &gt;&gt; /var/log/resque/orders.log &amp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionOrders</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;startWorkers(Yii2Resque::QUEUE_ORDERS, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动消费 QUEUE_EMAIL 队列的 Worker</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ./yii resque/email &gt;&gt; /var/log/resque/email.log &amp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionEmail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;startWorkers(Yii2Resque::QUEUE_EMAIL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动计划任务消费的 Worker</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ./yii resque/start-schedule &gt;&gt; /var/log/resque/schedule.log &amp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionStartSchedule</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 设置Redis</span></span><br><span class="line">        $redis = Yii::$app-&gt;redis;</span><br><span class="line">        $REDIS_BACKEND = <span class="string">"redis://:$redis-&gt;password@$redis-&gt;hostname:$redis-&gt;port"</span>;</span><br><span class="line">        Resque::setBackend($REDIS_BACKEND);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动计划任务 Worker</span></span><br><span class="line">        $worker = <span class="keyword">new</span> ResqueScheduler_Worker();</span><br><span class="line">        $worker-&gt;logLevel = ResqueScheduler_Worker::LOG_NORMAL;</span><br><span class="line">        fwrite(STDOUT, <span class="string">"*** Starting scheduler worker\n"</span>);</span><br><span class="line">        $worker-&gt;work(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动 worker</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $queue_name string 队列名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $count integer worker个数，默认1个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $interval integer 间隔秒数，默认5秒</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $prefix string Redis命名空间(前缀)，默认: resque</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">startWorkers</span><span class="params">($queue_name, $count = <span class="number">1</span>, $interval = <span class="number">5</span>, $prefix = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 设置Redis</span></span><br><span class="line">        $redis = Yii::$app-&gt;redis;</span><br><span class="line">        $REDIS_BACKEND = <span class="string">"redis://:$redis-&gt;password@$redis-&gt;hostname:$redis-&gt;port"</span>;</span><br><span class="line">        Resque::setBackend($REDIS_BACKEND);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置日志</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($logger) || !is_object($logger)) &#123;</span><br><span class="line">            $logger = <span class="keyword">new</span> Resque_Log(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置Redis命名空间前缀，默认:resque</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>($prefix)) &#123;</span><br><span class="line">            $logger-&gt;log(LogLevel::INFO, <span class="string">'Prefix set to &#123;prefix&#125;'</span>, <span class="keyword">array</span>(<span class="string">'prefix'</span> =&gt; $prefix));</span><br><span class="line">            Resque_Redis::prefix($prefix);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动 Worker</span></span><br><span class="line">        <span class="keyword">if</span> ($count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $count; ++$i) &#123;</span><br><span class="line">                $pid = Resque::fork();</span><br><span class="line">                <span class="keyword">if</span> ($pid === <span class="keyword">false</span> || $pid === <span class="number">-1</span>) &#123;</span><br><span class="line">                    $logger-&gt;log(LogLevel::EMERGENCY, <span class="string">'Could not fork worker &#123;count&#125;'</span>, <span class="keyword">array</span>(<span class="string">'count'</span> =&gt; $i));</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!$pid) &#123;</span><br><span class="line">                    <span class="comment">// Child, start the worker</span></span><br><span class="line">                    $queues = explode(<span class="string">','</span>, $queue_name);</span><br><span class="line">                    $worker = <span class="keyword">new</span> Resque_Worker($queues);</span><br><span class="line">                    $worker-&gt;setLogger($logger);</span><br><span class="line">                    $logger-&gt;log(LogLevel::NOTICE, <span class="string">'Starting worker &#123;worker&#125;'</span>, <span class="keyword">array</span>(<span class="string">'worker'</span> =&gt; $worker));</span><br><span class="line">                    $worker-&gt;work($interval);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Start a single worker</span></span><br><span class="line">            $queues = explode(<span class="string">','</span>, $queue_name);</span><br><span class="line">            $worker = <span class="keyword">new</span> Resque_Worker($queues);</span><br><span class="line">            $worker-&gt;setLogger($logger);</span><br><span class="line"></span><br><span class="line">            $logger-&gt;log(LogLevel::NOTICE, <span class="string">'Starting worker &#123;worker&#125;'</span>, <span class="keyword">array</span>(<span class="string">'worker'</span> =&gt; $worker));</span><br><span class="line">            $worker-&gt;work($interval);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Yii2的配置"><a href="#Yii2的配置" class="headerlink" title="Yii2的配置"></a>Yii2的配置</h3><p>为了方便Yii2 Web应用程序生产Job，我这里将生产Job的方法封装为一个Component，具体代码见如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">common</span>\<span class="title">components</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Resque_Job_Status</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">ResqueScheduler</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Yii</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">base</span>\<span class="title">Component</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Resque组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Class Yii2Resque</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> common\components</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yii2Resque</span> <span class="keyword">extends</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> QUEUE_ORDERS = <span class="string">"orders"</span>; <span class="comment">//订单队列，用来处理订单相关的任务</span></span><br><span class="line">    <span class="keyword">const</span> QUEUE_EMAIL = <span class="string">"email"</span>; <span class="comment">//邮件队列，用来处理邮件相关的任务</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::init();</span><br><span class="line"></span><br><span class="line">        $redis = Yii::$app-&gt;redis;</span><br><span class="line">        Resque::setBackend(<span class="string">"redis://:$redis-&gt;password@$redis-&gt;hostname:$redis-&gt;port"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new job and save it to the specified queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $queue The name of the queue to place the job in.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $class The name of the class that contains the code to execute the job.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $args Any optional arguments that should be passed when the job is executed.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createJob</span><span class="params">($queue, $class, $args = array<span class="params">()</span>, $track_status = false)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Resque::enqueue($queue, $class, $args, $track_status);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new scheduled job and save it to the specified queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $in Second count down to job.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $queue The name of the queue to place the job in.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $class The name of the class that contains the code to execute the job.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $args Any optional arguments that should be passed when the job is executed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">enqueueJobIn</span><span class="params">($in, $queue, $class, $args = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ResqueScheduler::enqueueIn($in, $queue, $class, $args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new scheduled job and save it to the specified queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timestamp $at UNIX timestamp when job should be executed.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $queue The name of the queue to place the job in.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $class The name of the class that contains the code to execute the job.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $args Any optional arguments that should be passed when the job is executed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">enqueueJobAt</span><span class="params">($at, $queue, $class, $args = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        ResqueScheduler::enqueueAt($at, $queue, $class, $args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get delayed jobs count</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getDelayedJobsCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (int)Resque::redis()-&gt;zcard(<span class="string">'delayed_queue_schedule'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Check job status</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $token Job token ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string Job Status</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">status</span><span class="params">($token)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $status = <span class="keyword">new</span> Resque_Job_Status($token);</span><br><span class="line">        <span class="keyword">return</span> $status-&gt;get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return Redis</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object Redis instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">redis</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Resque::redis();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get queues</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object Redis instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getQueues</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;redis()-&gt;zRange(<span class="string">'delayed_queue_schedule'</span>, <span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="首先启动-Worker守护进程（这里以orders队列为例）"><a href="#首先启动-Worker守护进程（这里以orders队列为例）" class="headerlink" title="首先启动 Worker守护进程（这里以orders队列为例）"></a>首先启动 Worker守护进程（这里以orders队列为例）</h3><p>注意在这之前，需要保证你Redis处于正常启动状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /path/to/yii2-project-root</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./yii resque/orders &gt;&gt; /var/<span class="built_in">log</span>/resque/orders.log &amp;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./yii resque/start-schedule &gt;&gt; /var/<span class="built_in">log</span>/resque/schedule.log &amp;</span></span><br></pre></td></tr></table></figure>
<h3 id="为了演示，我们可以通过日志来观察"><a href="#为了演示，我们可以通过日志来观察" class="headerlink" title="为了演示，我们可以通过日志来观察"></a>为了演示，我们可以通过日志来观察</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tail -f /var/<span class="built_in">log</span>/resque/*.<span class="built_in">log</span></span></span><br></pre></td></tr></table></figure>
<h3 id="生产Job，观察日志输出"><a href="#生产Job，观察日志输出" class="headerlink" title="生产Job，观察日志输出"></a>生产Job，观察日志输出</h3><h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">console</span>\<span class="title">jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">helpers</span>\<span class="title">ArrayHelper</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理订单的异步任务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Class OrderJob</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> console\jobs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderJob</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行任务的前置条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dump(<span class="string">"===&gt; 这里放一些任务执行之前需要处理的逻辑代码"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">perform</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dump(<span class="string">"这里可以接受参数的哦，比方说我们取一下order_id:"</span> . ArrayHelper::getValue(<span class="keyword">$this</span>-&gt;args, <span class="string">'id'</span>));</span><br><span class="line">        dump(<span class="string">"这里是具体的处理订单的逻辑代码"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行任务的后置条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tearDown</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dump(<span class="string">"===&gt; 这里放一些任务处理之后需要处理的逻辑代码"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="生产一个即使处理的任务-可通过Yii2的命令行脚本来测试"><a href="#生产一个即使处理的任务-可通过Yii2的命令行脚本来测试" class="headerlink" title="生产一个即使处理的任务(可通过Yii2的命令行脚本来测试)"></a>生产一个即使处理的任务(可通过Yii2的命令行脚本来测试)</h4><h5 id="1-创建一个-console-controllers-TestController-php"><a href="#1-创建一个-console-controllers-TestController-php" class="headerlink" title="1. 创建一个/console/controllers/TestController.php"></a>1. 创建一个/console/controllers/TestController.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试需要即时消费的订单任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionOrder</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Yii::$app-&gt;resque-&gt;createJob(Yii2Resque::QUEUE_ORDERS, OrderJob::class, [<span class="string">"id"</span> =&gt; <span class="number">100</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-将OrderJob放入队列"><a href="#2-将OrderJob放入队列" class="headerlink" title="2. 将OrderJob放入队列"></a>2. 将OrderJob放入队列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /path/to/yii2-project-root</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./yii <span class="built_in">test</span>/order</span></span><br></pre></td></tr></table></figure>
<h5 id="3-观察日志输出，检测OrderJob是否被消费"><a href="#3-观察日志输出，检测OrderJob是否被消费" class="headerlink" title="3. 观察日志输出，检测OrderJob是否被消费"></a>3. 观察日志输出，检测OrderJob是否被消费</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /var/log/resque/orders.log &lt;==</span><br><span class="line">[notice] Starting work on (Job&#123;orders&#125; | ID: 28974156fc5ae0fcfa6e64b9c50dae76 | console\jobs\OrderJob | [&#123;"id":100&#125;])</span><br><span class="line">"===&gt; 这里放一些任务执行之前需要处理的逻辑代码"</span><br><span class="line">"这里可以接受参数的哦，比方说我们取一下order_id:100"</span><br><span class="line">"这里是具体的处理订单的逻辑代码"</span><br><span class="line">"===&gt; 这里放一些任务处理之后需要处理的逻辑代码"</span><br><span class="line">[notice] (Job&#123;orders&#125; | ID: 28974156fc5ae0fcfa6e64b9c50dae76 | console\jobs\OrderJob | [&#123;"id":100&#125;]) has finished</span><br></pre></td></tr></table></figure>
<h4 id="生产一个延时处理的任务-可通过Yii2的命令行脚本来测试"><a href="#生产一个延时处理的任务-可通过Yii2的命令行脚本来测试" class="headerlink" title="生产一个延时处理的任务(可通过Yii2的命令行脚本来测试)"></a>生产一个延时处理的任务(可通过Yii2的命令行脚本来测试)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试需要延时消费的订单任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionDelayOrder</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Yii::$app-&gt;resque-&gt;enqueueJobIn(<span class="number">10</span>, Yii2Resque::QUEUE_ORDERS, OrderJob::class, [<span class="string">"id"</span> =&gt; <span class="number">666</span>]); <span class="comment">//延迟10s执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-将OrderJob放入队列-1"><a href="#2-将OrderJob放入队列-1" class="headerlink" title="2. 将OrderJob放入队列"></a>2. 将OrderJob放入队列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /path/to/yii2-project-root</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./yii <span class="built_in">test</span>/delay-order</span></span><br></pre></td></tr></table></figure>
<h5 id="3-观察日志输出，检测OrderJob是否被消费-1"><a href="#3-观察日志输出，检测OrderJob是否被消费-1" class="headerlink" title="3. 观察日志输出，检测OrderJob是否被消费"></a>3. 观察日志输出，检测OrderJob是否被消费</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /var/log/resque/schedule.log &lt;==</span><br><span class="line">*** queueing console\jobs\OrderJob in orders [delayed]</span><br><span class="line"></span><br><span class="line">==&gt; /var/log/resque/orders.log &lt;==</span><br><span class="line">[notice] Starting work on (Job&#123;orders&#125; | ID: 6066ab9cc46c5452c86ea470413e4f78 | console\jobs\OrderJob | [&#123;"id":666&#125;])</span><br><span class="line">"===&gt; 这里放一些任务执行之前需要处理的逻辑代码"</span><br><span class="line">"这里可以接受参数的哦，比方说我们取一下order_id:666"</span><br><span class="line">"这里是具体的处理订单的逻辑代码"</span><br><span class="line">"===&gt; 这里放一些任务处理之后需要处理的逻辑代码"</span><br><span class="line">[notice] (Job&#123;orders&#125; | ID: 6066ab9cc46c5452c86ea470413e4f78 | console\jobs\OrderJob | [&#123;"id":666&#125;]) has finished</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://victor87.coding.me/2017/09/07/消息队列和计划任务/" data-id="ck4ccwn4p006l19vp3zpqvbhy" class="article-share-link">分享到</a><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/NoSQL/">NoSQL</a><a href="/tags/消息队列/">消息队列</a><a href="/tags/Yii2/">Yii2</a><a href="/tags/Redis/">Redis</a></div><div class="post-nav"><a href="/2017/09/15/R语言初识/" class="pre">R语言初识</a><a href="/2017/08/31/redis/" class="next">redis</a></div><div data-thread-key="2017/09/07/消息队列和计划任务/" data-title="消息队列和计划任务" data-url="http://victor87.coding.me/2017/09/07/消息队列和计划任务/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/09/07/消息队列和计划任务/" data-title="消息队列和计划任务" data-url="http://victor87.coding.me/2017/09/07/消息队列和计划任务/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://victor87.coding.me"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IoT/">IoT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-Mac/">iOS & Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据-AI/">大数据 & AI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络安全/">网络安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目管理/">项目管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/消息队列/" style="font-size: 15px;">消息队列</a> <a href="/tags/EasyDL/" style="font-size: 15px;">EasyDL</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Android-Things/" style="font-size: 15px;">Android Things</a> <a href="/tags/物联网/" style="font-size: 15px;">物联网</a> <a href="/tags/NXP-i-MX7D/" style="font-size: 15px;">NXP i.MX7D</a> <a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/持续集成/" style="font-size: 15px;">持续集成</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Coding/" style="font-size: 15px;">Coding</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Firebase/" style="font-size: 15px;">Firebase</a> <a href="/tags/GitLab/" style="font-size: 15px;">GitLab</a> <a href="/tags/travis/" style="font-size: 15px;">travis</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Annotation/" style="font-size: 15px;">Annotation</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/动态代理/" style="font-size: 15px;">动态代理</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/守护进程/" style="font-size: 15px;">守护进程</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/备份/" style="font-size: 15px;">备份</a> <a href="/tags/还原/" style="font-size: 15px;">还原</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Homebrew/" style="font-size: 15px;">Homebrew</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/NoSQL/" style="font-size: 15px;">NoSQL</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/Mosquitto/" style="font-size: 15px;">Mosquitto</a> <a href="/tags/深度学习/" style="font-size: 15px;">深度学习</a> <a href="/tags/权限认证/" style="font-size: 15px;">权限认证</a> <a href="/tags/QQ授权/" style="font-size: 15px;">QQ授权</a> <a href="/tags/Redmine/" style="font-size: 15px;">Redmine</a> <a href="/tags/Rails/" style="font-size: 15px;">Rails</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/R/" style="font-size: 15px;">R</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/科学计算/" style="font-size: 15px;">科学计算</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Spring-Boot/" style="font-size: 15px;">Spring Boot</a> <a href="/tags/Systemd/" style="font-size: 15px;">Systemd</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Yii2/" style="font-size: 15px;">Yii2</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/图片浏览器/" style="font-size: 15px;">图片浏览器</a> <a href="/tags/宏定义/" style="font-size: 15px;">宏定义</a> <a href="/tags/软键盘/" style="font-size: 15px;">软键盘</a> <a href="/tags/图片截取/" style="font-size: 15px;">图片截取</a> <a href="/tags/Memcached/" style="font-size: 15px;">Memcached</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Gitlab/" style="font-size: 15px;">Gitlab</a> <a href="/tags/Swoole/" style="font-size: 15px;">Swoole</a> <a href="/tags/产品/" style="font-size: 15px;">产品</a> <a href="/tags/需求分析/" style="font-size: 15px;">需求分析</a> <a href="/tags/Range/" style="font-size: 15px;">Range</a> <a href="/tags/重叠/" style="font-size: 15px;">重叠</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/移动支付/" style="font-size: 15px;">移动支付</a> <a href="/tags/985/" style="font-size: 15px;">985</a> <a href="/tags/211/" style="font-size: 15px;">211</a> <a href="/tags/大学分布/" style="font-size: 15px;">大学分布</a> <a href="/tags/Fresco/" style="font-size: 15px;">Fresco</a> <a href="/tags/ARC/" style="font-size: 15px;">ARC</a> <a href="/tags/端口映射/" style="font-size: 15px;">端口映射</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/启动原理/" style="font-size: 15px;">启动原理</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/19/如何将内网Web服务暴露给外网访问/">如何将内网Web服务暴露给外网访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/18/5分钟教你实现头像识别/">5分钟教你实现头像识别</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/20/Mac双系统安装/">Mac双系统安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/22/Centos7-php升级/">Centos7 php升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/21/PHP数据类型声明那些事/">PHP数据类型声明那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/GitLab持续集成CI/">GitLab持续集成CI</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/20/GitLab重置管理员密码/">GitLab重置管理员密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/Git冲突解决方案/">Git冲突解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/22/Spring-Boot入门/">Spring Boot入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/区间Range重叠算法/">区间Range重叠算法</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://jikedaohang.com/" title="极客导航" target="_blank">极客导航</a><ul></ul><a href="http://www.rowkey.me/" title="后端技术杂谈" target="_blank">后端技术杂谈</a><ul></ul><a href="http://www.fancyecommerce.com/" title="YII2 教程" target="_blank">YII2 教程</a><ul></ul><a href="http://objccn.io/" title="objc中国" target="_blank">objc中国</a><ul></ul><a href="http://www.ruanyifeng.com/" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Victor.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'wangsheng87'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>