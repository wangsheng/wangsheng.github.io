<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="baidu-site-verification" content="4VgVZ78vNs"><meta name="google-site-verification" content="fFPOHpbXBh9IoQIShIVnGpxUmWIa55Aa1187v0em7Lo"><meta name="description"><title>Linux 守护进程的启动方法 | Victor</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux 守护进程的启动方法</h1><a id="logo" href="/.">Victor</a><p class="description">问渠哪得清如许，为有源头活水来</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Linux 守护进程的启动方法</h1><div class="post-meta">Nov 26, 2017<span> | </span><span class="category"><a href="/categories/Linux/">Linux</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/11/26/Linux-守护进程的启动方法/" href="/2017/11/26/Linux-守护进程的启动方法/#comments" class="ds-thread-count"></a><div class="post-content"><p>“<a href="http://baike.baidu.com/view/53123.htm" target="_blank" rel="noopener">守护进程</a>“（daemon）就是一直在后台运行的进程（daemon）。</p>
<p>本文介绍如何将一个 Web 应用，启动为守护进程。<br><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016022801.png" alt="deamon"></p>
<h2 id="一、问题的由来"><a href="#一、问题的由来" class="headerlink" title="一、问题的由来"></a>一、问题的由来</h2><p>Web应用写好后，下一件事就是启动，让它一直在后台运行。<br>这并不容易。举例来说，下面是一个最简单的Node应用server.js，只有6行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">  res.end(<span class="string">'Hello World'</span>);</span><br><span class="line">&#125;).listen(<span class="number">5000</span>);</span><br></pre></td></tr></table></figure>
<p>你在命令行下启动它。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node server.js</span></span><br></pre></td></tr></table></figure>
<p>看上去一切正常，所有人都能快乐地访问 5000 端口了。但是，一旦你退出命令行窗口，这个应用就一起退出了，无法访问了。<br>怎么才能让它变成系统的守护进程（daemon），成为一种服务（service），一直在那里运行呢？</p>
<h2 id="二、前台任务与后台任务"><a href="#二、前台任务与后台任务" class="headerlink" title="二、前台任务与后台任务"></a>二、前台任务与后台任务</h2><p>上面这样启动的脚本，称为”前台任务”（foreground job）。它会独占命令行窗口，只有运行完了或者手动中止，才能执行其他命令。</p>
<p>变成守护进程的第一步，就是把它改成”后台任务”（background job）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node server.js &amp;</span></span><br></pre></td></tr></table></figure>
<p>只要在命令的尾部加上符号&amp;，启动的进程就会成为”后台任务”。如果要让正在运行的”前台任务”变为”后台任务”，可以先按ctrl + z，然后执行bg命令（让最近一个暂停的”后台任务”继续执行）。</p>
<p>“后台任务”有两个特点。</p>
<blockquote>
<ol>
<li>继承当前 session （对话）的标准输出（stdout）和标准错误（stderr）。因此，后台任务的所有输出依然会同步地在命令行下显示。</li>
<li>不再继承当前 session 的标准输入（stdin）。你无法向这个任务输入指令了。如果它试图读取标准输入，就会暂停执行（halt）。</li>
</ol>
</blockquote>
<p>可以看到，”后台任务”与”前台任务”的本质区别只有一个：是否继承标准输入。所以，执行后台任务的同时，用户还可以输入其他命令。</p>
<h2 id="三、SIGHUP信号"><a href="#三、SIGHUP信号" class="headerlink" title="三、SIGHUP信号"></a>三、SIGHUP信号</h2><p>变为”后台任务”后，一个进程是否就成为了守护进程呢？或者说，用户退出 session 以后，”后台任务”是否还会继续执行？</p>
<p>Linux系统是这样设计的。</p>
<blockquote>
<ol>
<li>用户准备退出 session</li>
<li>系统向该 session 发出SIGHUP信号</li>
<li>session 将SIGHUP信号发给所有子进程</li>
<li>子进程收到SIGHUP信号后，自动退出</li>
</ol>
</blockquote>
<p>上面的流程解释了，为什么”前台任务”会随着 session 的退出而退出：因为它收到了<code>SIGHUP</code>信号。</p>
<p>那么，”后台任务”是否也会收到<code>SIGHUP</code>信号？</p>
<p>这由 Shell 的<code>huponexit</code>参数决定的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">shopt</span> | grep huponexit</span></span><br></pre></td></tr></table></figure>
<p>执行上面的命令，就会看到<code>huponexit</code>参数的值。<br>大多数Linux系统，这个参数默认关闭（<code>off</code>）。因此，session 退出的时候，不会把<code>SIGHUP</code>信号发给”后台任务”。所以，一般来说，”后台任务”不会随着 session 一起退出。</p>
<h2 id="四、disown-命令"><a href="#四、disown-命令" class="headerlink" title="四、disown 命令"></a>四、disown 命令</h2><p>通过”后台任务”启动”守护进程”并不保险，因为有的系统的<code>huponexit</code>参数可能是打开的（<code>on</code>）。</p>
<p>更保险的方法是使用<code>disown</code>命令。它可以将指定任务从”后台任务”列表（jobs命令的返回结果）之中移除。一个”后台任务”只要不在这个列表之中，session 就肯定不会向它发出SIGHUP信号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node server.js &amp;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span></span></span><br></pre></td></tr></table></figure>
<p>执行上面的命令以后，server.js进程就被移出了”后台任务”列表。你可以执行jobs命令验证，输出结果里面，不会有这个进程。</p>
<p>disown的用法如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 移出最近一个正在执行的后台任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移出所有正在执行的后台任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span> -r</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移出所有后台任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span> -a</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不移出后台任务，但是让它们不会收到SIGHUP信号</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span> -h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据jobId，移出指定的后台任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span> %2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span> -h %2</span></span><br></pre></td></tr></table></figure>
<h2 id="五、标准-I-O"><a href="#五、标准-I-O" class="headerlink" title="五、标准 I/O"></a>五、标准 I/O</h2><p>使用<code>disown</code>命令之后，还有一个问题。那就是，退出 session 以后，如果后台进程与标准I/O有交互，它还是会挂掉。</p>
<p>还是以上面的脚本为例，现在加入一行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var http = require('http');</span><br><span class="line"></span><br><span class="line">http.createServer(function(req, res) &#123;</span><br><span class="line">  console.log('server starts...'); // 加入此行</span><br><span class="line">  res.writeHead(200, &#123;'Content-Type': 'text/plain'&#125;);</span><br><span class="line">  res.end('Hello World');</span><br><span class="line">&#125;).listen(5000);</span><br></pre></td></tr></table></figure>
<p>启动上面的脚本，然后再执行<code>disown</code>命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node server.js &amp;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span></span></span><br></pre></td></tr></table></figure>
<p>接着，你退出 session，访问5000端口，就会发现连不上。</p>
<p>这是因为”后台任务”的标准 I/O 继承自当前 session，disown命令并没有改变这一点。一旦”后台任务”读写标准 I/O，就会发现它已经不存在了，所以就报错终止执行。</p>
<p>为了解决这个问题，需要对”后台任务”的标准 I/O 进行重定向。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node server.js &gt; stdout.txt 2&gt; stderr.txt &lt; /dev/null &amp;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">disown</span></span></span><br></pre></td></tr></table></figure>
<p>上面这样执行，基本上就没有问题了。</p>
<h2 id="六、nohup-命令"><a href="#六、nohup-命令" class="headerlink" title="六、nohup 命令"></a>六、nohup 命令</h2><p>还有比<code>disown</code>更方便的命令，就是<code>nohup</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nohup node server.js &amp;</span></span><br></pre></td></tr></table></figure>
<p><code>nohup</code>命令对server.js进程做了三件事。</p>
<blockquote>
<p>阻止SIGHUP信号发到这个进程。<br>关闭标准输入。该进程不再能够接收任何输入，即使运行在前台。<br>重定向标准输出和标准错误到文件nohup.out。</p>
</blockquote>
<p>也就是说，<code>nohup</code>命令实际上将子进程与它所在的 session 分离了。<br>注意，nohup命令不会自动把进程变为”后台任务”，所以必须加上&amp;符号。</p>
<h2 id="七、Screen-命令与-Tmux-命令"><a href="#七、Screen-命令与-Tmux-命令" class="headerlink" title="七、Screen 命令与 Tmux 命令"></a>七、Screen 命令与 Tmux 命令</h2><p>另一种思路是使用 terminal multiplexer （终端复用器：在同一个终端里面，管理多个session），典型的就是 <a href="https://www.gnu.org/software/screen/" target="_blank" rel="noopener">Screen</a> 命令和 <a href="https://tmux.github.io/" target="_blank" rel="noopener">Tmux</a> 命令。</p>
<p>它们可以在当前 session 里面，新建另一个 session。这样的话，当前 session 一旦结束，不影响其他 session。而且，以后重新登录，还可以再连上早先新建的 session。</p>
<p>Screen 的用法如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建一个 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> screen</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> node server.js</span></span><br></pre></td></tr></table></figure>
<p>然后，按下ctrl + A和ctrl + D，回到原来的 session，从那里退出登录。下次登录时，再切回去。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> screen -r</span></span><br></pre></td></tr></table></figure>
<p>如果新建多个后台 session，就需要为它们指定名字。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> screen -S name</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切回指定 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> screen -r name</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> screen -r pid_number</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> screen -ls</span></span><br></pre></td></tr></table></figure>
<p>如果要停掉某个 session，可以先切回它，然后按下ctrl + c和ctrl + d。<br>Tmux 比 Screen 功能更多、更强大，它的基本用法如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tmux</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> node server.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回原来的session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux detach</span></span><br></pre></td></tr></table></figure>
<p>除了tmux detach，另一种方法是按下Ctrl + B和d ，也可以回到原来的 session。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下次登录时，返回后台正在运行服务session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux attach</span></span><br></pre></td></tr></table></figure>
<p>如果新建多个 session，就需要为每个 session 指定名字。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux new -s session_name</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到指定 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux attach -t session_name</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux list-sessions</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出当前 session，返回前一个 session </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux detach</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 杀死指定 session</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tmux <span class="built_in">kill</span>-session -t session-name</span></span><br></pre></td></tr></table></figure>
<h2 id="八、Node-工具"><a href="#八、Node-工具" class="headerlink" title="八、Node 工具"></a>八、Node 工具</h2><p>对于 Node 应用来说，可以不用上面的方法，有一些专门用来启动的工具：<a href="https://github.com/foreverjs/forever" target="_blank" rel="noopener">forever</a>，<a href="http://nodemon.io/" target="_blank" rel="noopener">nodemon</a> 和 <a href="http://pm2.keymetrics.io/" target="_blank" rel="noopener">pm2</a>。</p>
<p>forever 的功能很简单，就是保证进程退出时，应用会自动重启。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 作为前台任务启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever server.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 作为服务进程启动 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever start app.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止服务进程</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever stop Id</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务进程</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever restart Id</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 监视当前目录的文件变动，一有变动就重启</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever -w server.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -m 参数指定最多重启次数</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever -m 5 server.js </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有进程</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> forever list</span></span><br></pre></td></tr></table></figure>
<p><code>nodemon</code>一般只在开发时使用，它最大的长处在于 watch 功能，一旦文件发生变化，就自动重启进程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 默认监视当前目录的文件变化</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nodemon server.js</span></span><br><span class="line"></span><br><span class="line">＃ 监视指定文件的变化   </span><br><span class="line"><span class="meta">$</span><span class="bash"> nodemon --watch app --watch libs server.js</span></span><br></pre></td></tr></table></figure>
<p>pm2 的功能最强大，除了重启进程以外，还能实时收集日志和监控。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动应用</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 start app.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定同时起多少个进程（由CPU核心数决定），组成一个集群</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 start app.js -i max</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 list</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止指定任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 stop 0</span></span><br><span class="line"></span><br><span class="line">＃ 重启指定任务</span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 restart 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定任务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 delete 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存当前的所有任务，以后可以恢复</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 save</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出每个进程的统计数据</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 monit</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有日志</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 logs</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导出数据</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 dump</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启所有进程</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 <span class="built_in">kill</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 resurect</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动web界面 http://localhost:9615</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 web</span></span><br></pre></td></tr></table></figure>
<h2 id="十、Systemd"><a href="#十、Systemd" class="headerlink" title="十、Systemd"></a>十、Systemd</h2><p>除了专用工具以外，Linux系统有自己的守护进程管理工具 Systemd 。它是操作系统的一部分，直接与内核交互，性能出色，功能极其强大。我们完全可以将程序交给 Systemd ，让系统统一管理，成为真正意义上的系统服务。</p>
<p>下一篇文章，我就来介绍 <a href="http://victor87.coding.me/2017/11/26/Systemd-cmd/">Systemd</a>。</p>
<p>（完）</p>
<p>转自：<a href="http://www.ruanyifeng.com/blog/2016/02/linux-daemon.html" target="_blank" rel="noopener">阮一峰 - Linux 守护进程的启动方法
</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://victor87.coding.me/2017/11/26/Linux-守护进程的启动方法/" data-id="ck4ccwn2p002019vpbtkhw0lm" class="article-share-link">分享到</a><div class="tags"><a href="/tags/计算机基础/">计算机基础</a><a href="/tags/Linux/">Linux</a><a href="/tags/守护进程/">守护进程</a></div><div class="post-nav"><a href="/2017/11/26/Systemd-cmd/" class="pre">Systemd 基础篇</a><a href="/2017/11/26/Linux-的启动流程/" class="next">Linux 的启动流程</a></div><div data-thread-key="2017/11/26/Linux-守护进程的启动方法/" data-title="Linux 守护进程的启动方法" data-url="http://victor87.coding.me/2017/11/26/Linux-守护进程的启动方法/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/11/26/Linux-守护进程的启动方法/" data-title="Linux 守护进程的启动方法" data-url="http://victor87.coding.me/2017/11/26/Linux-守护进程的启动方法/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://victor87.coding.me"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IoT/">IoT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-Mac/">iOS & Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据-AI/">大数据 & AI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络安全/">网络安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目管理/">项目管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/消息队列/" style="font-size: 15px;">消息队列</a> <a href="/tags/EasyDL/" style="font-size: 15px;">EasyDL</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Android-Things/" style="font-size: 15px;">Android Things</a> <a href="/tags/物联网/" style="font-size: 15px;">物联网</a> <a href="/tags/NXP-i-MX7D/" style="font-size: 15px;">NXP i.MX7D</a> <a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/持续集成/" style="font-size: 15px;">持续集成</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Coding/" style="font-size: 15px;">Coding</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Firebase/" style="font-size: 15px;">Firebase</a> <a href="/tags/GitLab/" style="font-size: 15px;">GitLab</a> <a href="/tags/travis/" style="font-size: 15px;">travis</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Annotation/" style="font-size: 15px;">Annotation</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/动态代理/" style="font-size: 15px;">动态代理</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/守护进程/" style="font-size: 15px;">守护进程</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/备份/" style="font-size: 15px;">备份</a> <a href="/tags/还原/" style="font-size: 15px;">还原</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Homebrew/" style="font-size: 15px;">Homebrew</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/NoSQL/" style="font-size: 15px;">NoSQL</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/Mosquitto/" style="font-size: 15px;">Mosquitto</a> <a href="/tags/深度学习/" style="font-size: 15px;">深度学习</a> <a href="/tags/权限认证/" style="font-size: 15px;">权限认证</a> <a href="/tags/QQ授权/" style="font-size: 15px;">QQ授权</a> <a href="/tags/Redmine/" style="font-size: 15px;">Redmine</a> <a href="/tags/Rails/" style="font-size: 15px;">Rails</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/R/" style="font-size: 15px;">R</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/科学计算/" style="font-size: 15px;">科学计算</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Spring-Boot/" style="font-size: 15px;">Spring Boot</a> <a href="/tags/Systemd/" style="font-size: 15px;">Systemd</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Yii2/" style="font-size: 15px;">Yii2</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/图片浏览器/" style="font-size: 15px;">图片浏览器</a> <a href="/tags/宏定义/" style="font-size: 15px;">宏定义</a> <a href="/tags/软键盘/" style="font-size: 15px;">软键盘</a> <a href="/tags/图片截取/" style="font-size: 15px;">图片截取</a> <a href="/tags/Memcached/" style="font-size: 15px;">Memcached</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Gitlab/" style="font-size: 15px;">Gitlab</a> <a href="/tags/Swoole/" style="font-size: 15px;">Swoole</a> <a href="/tags/产品/" style="font-size: 15px;">产品</a> <a href="/tags/需求分析/" style="font-size: 15px;">需求分析</a> <a href="/tags/Range/" style="font-size: 15px;">Range</a> <a href="/tags/重叠/" style="font-size: 15px;">重叠</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/移动支付/" style="font-size: 15px;">移动支付</a> <a href="/tags/985/" style="font-size: 15px;">985</a> <a href="/tags/211/" style="font-size: 15px;">211</a> <a href="/tags/大学分布/" style="font-size: 15px;">大学分布</a> <a href="/tags/Fresco/" style="font-size: 15px;">Fresco</a> <a href="/tags/ARC/" style="font-size: 15px;">ARC</a> <a href="/tags/端口映射/" style="font-size: 15px;">端口映射</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/启动原理/" style="font-size: 15px;">启动原理</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/19/如何将内网Web服务暴露给外网访问/">如何将内网Web服务暴露给外网访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/18/5分钟教你实现头像识别/">5分钟教你实现头像识别</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/20/Mac双系统安装/">Mac双系统安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/22/Centos7-php升级/">Centos7 php升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/21/PHP数据类型声明那些事/">PHP数据类型声明那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/GitLab持续集成CI/">GitLab持续集成CI</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/20/GitLab重置管理员密码/">GitLab重置管理员密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/Git冲突解决方案/">Git冲突解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/22/Spring-Boot入门/">Spring Boot入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/区间Range重叠算法/">区间Range重叠算法</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://jikedaohang.com/" title="极客导航" target="_blank">极客导航</a><ul></ul><a href="http://www.rowkey.me/" title="后端技术杂谈" target="_blank">后端技术杂谈</a><ul></ul><a href="http://www.fancyecommerce.com/" title="YII2 教程" target="_blank">YII2 教程</a><ul></ul><a href="http://objccn.io/" title="objc中国" target="_blank">objc中国</a><ul></ul><a href="http://www.ruanyifeng.com/" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Victor.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'wangsheng87'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>